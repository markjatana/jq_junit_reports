<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Copyright 2012 Mark Jatana  -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>JJunit Report Demo</title>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
<meta name="language" content="en" />
<meta name="layout" content="main"></meta>
<link rel="stylesheet" href="../css/main.css" />
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script>

var data='[{"id": "1", "name":"CUT 1", "failures": "1","errors":"1","total":"2","completed":"2","testSuites":[{"id": "1","name":"VPPF_BAN","testCases":[{"id":"1", "name":"vso_ban","time":"3hrs","state":"passed"},{"id":"2", "name":"vse_ban","time":"2hrs","state":"failed"}]}]},{"id": "2", "name":"CUT 2", "failures": "0","errors":"0","total":"2","completed":"1","testSuites":[{"id": "21","name":"VPPF HIL","testCases":[{"id":"21", "name":"VSE","time":"3hrs","state":"passed"},{"id":"22", "name":"VSO","time":"2hrs","state":"passed"}]}]}]';

	$(document).ready(function() {
		var run = JSON.parse(data)
		for(var i=0; i < run.length ; i++){
			generateMarkUp(run[i]);	
		}
	});

	function generateMarkUp(run){
		generateRunContainers(run)
		generateSuites(run, run.id);
		for(var i = 0; i < run.testSuites.length; i++){
			generateCases(run.testSuites[i]);
		}
		addListeners(run);
	}
	
	
	function addListeners(run){
		for(var i = 0; i < run.testSuites.length; i++){
			
			var testSuite = run.testSuites[i];
			document.getElementById('runMargin_'+run.id).addEventListener("click", createHideListener(['suiteContainer_'+testSuite.id], 'runTwistie_'+run.id), false);
			
			var caseContainerIds = []
			for(var x=0; x < testSuite.testCases.length; x++){
				caseContainerIds.push( "caseContainer_"+testSuite.testCases[x].id)
			}
			document.getElementById('suiteMargin_'+testSuite.id).addEventListener("click", createHideListener(caseContainerIds, 'suiteTwistie_'+testSuite.id), false);
		}	
	}
	
	/*
		Add run containers
	*/
	function generateRunContainers(run){
		$(document.getElementById('testContainer')).prepend('<div id="run_'+ run.id +'" class="runContainer group">'
				+'<div class="runHeader group">'
					+'<div id="runMargin_'+ run.id +'" class="runMargin rounded group">'
						+'<div id="runTwistie_'+ run.id +'" class="runTwistie">-</div>'
					+'</div>'
					+'<div class="summary rounded">'
						+'<ol class="details group">'
						+ '<li>'+run.name+': '+run.completed+'/'+ run.total +'</li>'
						+ '<li>Errors: '+ run.errors +'</li>'
						+ '<li>Failures: '+ run.failures +'</li>'
						+'</ol>'
						+'<div id="progressBar_'+ run.id +'"class="progressBar"></div>'
					+'</div>'
				+'</div>'
			+'</div>');
		
		var progBar = document.getElementById('progressBar_'+run.id);
		$(progBar).width((run.completed/run.total)*100+'%');
		var color = 'red';
		if(run.failures ==0){
			color = 'green';
		}
		var runMargin = document.getElementById('runMargin_'+run.id);
		$(runMargin).addClass( 'fail' );
		
	}
	
	/* 
		Add suites
	*/
	function generateSuites(run, id){
			var runContainer = document.getElementById('run_'+id);
			for(var i = 0; i < run.testSuites.length; i++){
				var testSuite = run.testSuites[i];
				$(runContainer).append(
						'<div id="suiteContainer_'+ testSuite.id +'" class="suiteContainer group">'
						+	'<div class="suiteHeader group">'
						+		'<div id="suiteMargin_'+ testSuite.id +'" class="suiteMargin group rounded ">'
						+			'<div id="suiteTwistie_'+ testSuite.id +'" class="suiteTwistie">-</div>'
						+		'</div>'
						+		'<div class="suiteDetails rounded">'+ testSuite.name +'</div>'
						+	'</div>'		
					+	'</div>'		
			    );
				
			}
	}
	
	function generateCases(testSuite){
		var suiteContainerElement = document.getElementById('suiteContainer_1');
		for(var i = 0; i < testSuite.testCases.length; i++){
			var testCase = testSuite.testCases[i];
			$(suiteContainerElement).append(
					'<div id="caseContainer_'+ testCase.id +'" class="caseContainer group">'
			
					+	'<div id="caseHeader" class="caseHeader group">'
					+	'	<div id="caseMargin_'+ testCase.id +'" class="caseMargin rounded group odd">'	
					+			'<div id="caseTwistie_'+ testCase.id +'" class="caseTwistie">+</div>'
					+	'	</div>'
					+		'<div id="case_'+ testCase.id +'" class="caseDetails rounded group odd">' + testCase.name +'</div>'
					+		'</div>'
			
					+'</div>');
		}
	}
	
	

	function createHideListener(ids, twistieId){
		var hideElements = function(){
			for(var i=0;i < ids.length;i++){
				hide(ids[i])
			}
			switchTwistie(twistieId)
		}
		return hideElements;
	}

	function hide(id){
		$('#'+id).slideToggle('slow');
	}
	
	function switchTwistie(id){
		var less = "-";
		var more = "+";
		var element = document.getElementById(id)
		if(element.innerHTML == less){
			element.innerHTML = more
		}else{
			element.innerHTML = less
		}
	}
	

</script>

<!-- <script type="text/javascript"
	src="../js/"></script> -->

</head>
<body>
	<!-- title -->
	<div id="datTitle" class="datTitle">DAT : 1234567</div>
	<div id="testContainer" class="testContainer">
	<!-- start run -->
	<div class="runContainer group">
		<div class="runHeader group">
			<div id="runMargin" class="runMargin rounded group">
				<div id="runTwistie" class="runTwistie">+</div>
			</div>
			<div class="summary rounded">
				<ol class="details group">
					<li>CUT 1 : 8/15</li>
					<li>Errors: 3</li>
					<li>Failures: 4</li>
				</ol>
				<div class="progressBar"></div>
			</div>
		</div>
		<div id="suiteContainer" class="suiteContainer group">
			<div class="suiteHeader group">
				<div id="suiteMargin" class="suiteMargin group rounded ">
					<div id="suiteTwistie" class="suiteTwistie">-</div>
				</div>
				<div class="suiteDetails rounded">Name of VPPF Suite</div>
			</div>
			<div id="caseContainer1" class="caseContainer group">
				<div id="caseHeader" class="caseHeader group">
					<div class="caseMargin rounded group odd">
						<div class="caseTwistie">+</div>
					</div>
					<div id="case1" class="caseDetails rounded group odd">Case 1
						1h</div>
				</div>
			</div>
			<div id="caseContainer2" class="caseContainer group">
				<div class="caseHeader group">
					<div class="caseMargin rounded group ">
						<div class="caseTwistie">+</div>
					</div>
					<div class="caseDetails rounded group">Case 1 1h</div>
				</div>
			</div>
			<div id="caseContainer3" class="caseContainer group">
				<div class="caseHeader group">
					<div class="caseMargin rounded group odd">
						<div class="caseTwistie">+</div>
					</div>
					<div class="caseDetails rounded group odd">Case 1 1h</div>
				</div>
			</div>
		</div>
		
	</div>
	<!--  close run -->
	</div>
	<!--  close testContainer -->
</body>
</html>
